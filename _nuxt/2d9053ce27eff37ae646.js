(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{373:function(e,t,n){"use strict";var r=n(1),l=n(0);t.a=l.a.extend({name:"measurable",props:{height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},computed:{measurableStyles:function(){var e={},t=Object(r.a)(this.height),n=Object(r.a)(this.minHeight),l=Object(r.a)(this.minWidth),o=Object(r.a)(this.maxHeight),c=Object(r.a)(this.maxWidth),d=Object(r.a)(this.width);return t&&(e.height=t),n&&(e.minHeight=n),l&&(e.minWidth=l),o&&(e.maxHeight=o),c&&(e.maxWidth=c),d&&(e.width=d),e}}})},374:function(e,t,n){"use strict";var r=n(0);t.a=r.a.extend({name:"v-card-title",functional:!0,props:{primaryTitle:Boolean},render:function(e,t){var data=t.data,n=t.props,r=t.children;return data.staticClass=("v-card__title "+(data.staticClass||"")).trim(),n.primaryTitle&&(data.staticClass+=" v-card__title--primary"),e("div",data,r)}})},375:function(e,t,n){"use strict";n(376),n(377);var r=n(9);var l=n(0).a.extend({name:"elevatable",props:{elevation:[Number,String]},computed:{computedElevation:function(){return this.elevation},elevationClasses:function(){return this.computedElevation?(e={},t="elevation-"+this.computedElevation,n=!0,t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e):{};var e,t,n}}}),o=n(373),c=n(7),d=n(3),h=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e},v=Object(d.a)(r.a,l,o.a,c.a).extend({name:"v-sheet",props:{tag:{type:String,default:"div"},tile:Boolean},computed:{classes:function(){return h({"v-sheet":!0,"v-sheet--tile":this.tile},this.themeClasses,this.elevationClasses)},styles:function(){return this.measurableStyles}},render:function(e){var data={class:this.classes,style:this.styles,on:this.$listeners};return e(this.tag,this.setBackgroundColor(this.color,data),this.$slots.default)}}),m=n(41),f=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e};t.a=Object(d.a)(m.a,v).extend({name:"v-card",props:{flat:Boolean,hover:Boolean,img:String,raised:Boolean},computed:{classes:function(){return f({"v-card":!0,"v-card--flat":this.flat,"v-card--hover":this.hover},v.options.computed.classes.call(this))},styles:function(){var style=f({},v.options.computed.styles.call(this));return this.img&&(style.background='url("'+this.img+'") center center / cover no-repeat'),style}},render:function(e){var t=this.generateRouteLink(this.classes),n=t.tag,data=t.data;return data.style=this.styles,e(n,this.setBackgroundColor(this.color,data),this.$slots.default)}})},376:function(e,t,n){},377:function(e,t,n){},378:function(e,t,n){},379:function(e,t,n){},381:function(e,t,n){"use strict";n(117);var r=n(83);t.a=Object(r.a)("flex")},382:function(e,t,n){"use strict";n(117);var r=n(83);t.a=Object(r.a)("layout")},384:function(e,t,n){"use strict";var r=n(1),l=n(375),o=(n(378),n(379),n(373)),c=n(3),d=Object(c.a)(o.a).extend({name:"v-responsive",props:{aspectRatio:[String,Number]},computed:{computedAspectRatio:function(){return Number(this.aspectRatio)},aspectStyle:function(){return this.computedAspectRatio?{paddingBottom:1/this.computedAspectRatio*100+"%"}:void 0},__cachedSizer:function(){return this.aspectStyle?this.$createElement("div",{style:this.aspectStyle,staticClass:"v-responsive__sizer"}):[]}},methods:{genContent:function(){return this.$createElement("div",{staticClass:"v-responsive__content"},this.$slots.default)}},render:function(e){return e("div",{staticClass:"v-responsive",style:this.measurableStyles,on:this.$listeners},[this.__cachedSizer,this.genContent()])}}),h=n(6),v=d.extend({name:"v-img",props:{alt:String,contain:Boolean,src:{type:[String,Object],default:""},gradient:String,lazySrc:String,srcset:String,sizes:String,position:{type:String,default:"center center"},transition:{type:[Boolean,String],default:"fade-transition"}},data:function(){return{currentSrc:"",image:null,isLoading:!0,calculatedAspectRatio:void 0}},computed:{computedAspectRatio:function(){return this.normalisedSrc.aspect},normalisedSrc:function(){return"string"==typeof this.src?{src:this.src,srcset:this.srcset,lazySrc:this.lazySrc,aspect:Number(this.aspectRatio||this.calculatedAspectRatio)}:{src:this.src.src,srcset:this.srcset||this.src.srcset,lazySrc:this.lazySrc||this.src.lazySrc,aspect:Number(this.aspectRatio||this.src.aspect||this.calculatedAspectRatio)}},__cachedImage:function(){if(!this.normalisedSrc.src&&!this.normalisedSrc.lazySrc)return[];var e=[],t=this.isLoading?this.normalisedSrc.lazySrc:this.currentSrc;this.gradient&&e.push("linear-gradient("+this.gradient+")"),t&&e.push('url("'+t+'")');var image=this.$createElement("div",{staticClass:"v-image__image",class:{"v-image__image--preload":this.isLoading,"v-image__image--contain":this.contain,"v-image__image--cover":!this.contain},style:{backgroundImage:e.join(", "),backgroundPosition:this.position},key:+this.isLoading});return this.transition?this.$createElement("transition",{attrs:{name:this.transition,mode:"in-out"}},[image]):image}},watch:{src:function(){this.isLoading?this.loadImage():this.init()},"$vuetify.breakpoint.width":"getSrc"},mounted:function(){this.init()},methods:{init:function(){if(this.normalisedSrc.lazySrc){var e=new Image;e.src=this.normalisedSrc.lazySrc,this.pollForSize(e,null)}this.normalisedSrc.src&&this.loadImage()},onLoad:function(){this.getSrc(),this.isLoading=!1,this.$emit("load",this.src)},onError:function(){Object(h.a)("Image load failed\n\nsrc: "+this.normalisedSrc.src,this),this.$emit("error",this.src)},getSrc:function(){this.image&&(this.currentSrc=this.image.currentSrc||this.image.src)},loadImage:function(){var e=this,image=new Image;this.image=image,image.onload=function(){image.decode?image.decode().catch(function(t){Object(h.b)("Failed to decode image, trying to render anyway\n\nsrc: "+e.normalisedSrc.src+(t.message?"\nOriginal error: "+t.message:""),e)}).then(e.onLoad):e.onLoad()},image.onerror=this.onError,image.src=this.normalisedSrc.src,this.sizes&&(image.sizes=this.sizes),this.normalisedSrc.srcset&&(image.srcset=this.normalisedSrc.srcset),this.aspectRatio||this.pollForSize(image),this.getSrc()},pollForSize:function(img){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;!function n(){var r=img.naturalHeight,l=img.naturalWidth;r||l?e.calculatedAspectRatio=l/r:null!=t&&setTimeout(n,t)}()},__genPlaceholder:function(){if(this.$slots.placeholder){var e=this.isLoading?[this.$createElement("div",{staticClass:"v-image__placeholder"},this.$slots.placeholder)]:[];return this.transition?this.$createElement("transition",{attrs:{name:this.transition}},e):e[0]}}},render:function(e){var t=d.options.render.call(this,e);return t.data.staticClass+=" v-image",t.data.attrs={role:this.alt?"img":void 0,"aria-label":this.alt},t.children=[this.__cachedSizer,this.__cachedImage,this.__genPlaceholder(),this.genContent()],e(t.tag,t.data,t.children)}}).extend({name:"v-card-media",mounted:function(){Object(h.c)("v-card-media",this.src?"v-img":"v-responsive",this)}}),m=n(374);n.d(t,"a",function(){return _});var f=Object(r.c)("v-card__actions"),_=Object(r.c)("v-card__text");l.a,m.a},390:function(e,t,n){"use strict";n.r(t);var r=n(391),l=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,function(){return r[e]})}(o);t.default=l.a},391:function(e,t){},415:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-layout",{attrs:{column:"","justify-center":"","align-center":""}},[n("v-flex",{attrs:{xs12:"",sm8:"",md6:""}},[n("v-card",[n("v-card-title",{staticClass:"headline primary--text"},[e._v("L'asynchronisme avec les callbacks (2) - La librairie async")]),e._v(" "),n("v-card-text",[n("v-card-title",{staticClass:"subheading primary--text"},[e._v("Aller plus loin avec les callbacks")]),e._v(" "),n("p",[e._v("\n            L'écriture de code avec plusieurs appels asynchrones (en série ou en parallèle) peut s'avérer compliqué. En effet, il faut :\n            "),n("ul",[n("li",[e._v("appeler le callback une unique fois tout à la fin lorsque toutes les opérations asynchrones ont été effectuées avec succès ;")]),e._v(" "),n("li",[e._v("appeler le callback une unique fois dans le cas où une erreur survient.")])]),e._v("\n\n            De ce fait, on se retrouve souvent à avoir un callback, qui va appeler un callback... C'est ce qu'on appelle le "),n("strong",[e._v("callback hell")]),e._v(" :\n            "),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{attrs:{language:"js"}},[e._v("\nfs.readdir(source, function (err, files) {\n  if (err) {\n    console.log('Error finding files: ' + err)\n  } else {\n    files.forEach(function (filename, fileIndex) {\n      console.log(filename)\n      gm(source + filename).size(function (err, values) {\n        if (err) {\n          console.log('Error identifying file size: ' + err)\n        } else {\n          console.log(filename + ' : ' + values)\n          aspect = (values.width / values.height)\n          widths.forEach(function (width, widthIndex) {\n            height = Math.round(width / aspect)\n            console.log('resizing ' + filename + 'to ' + height + 'x' + height)\n            this.resize(width, height).write(dest + 'w' + width + '_' + filename, function(err) {\n              if (err) console.log('Error writing file: ' + err)\n            })\n          }.bind(this))\n        }\n      })\n    })\n  }\n})")])])]),e._v(" "),n("v-card-title",{staticClass:"subheading primary--text"},[e._v("La librairie async")]),e._v(" "),n("p",[e._v("\n            La solution est donc d'utiliser la librairie "),n("a",{attrs:{href:"https://caolan.github.io/async/"}},[e._v("async")]),e._v(",\n            qui permet de facilement gérer des workflows d'appels asynchrones.\n          ")]),e._v(" "),n("p",[e._v("\n            Par exemple, "),n("code",[e._v("map")]),e._v(" permet d'effectuer en parallèle la même opération asynchrone sur tous les éléments d'un tableau :\n            "),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{attrs:{language:"js"}},[e._v("async.map(['file1','file2','file3'], (file, next) => {\n  // appliqué de manière asynchrone sur tous les éléments du tableau\n  // la signature de next est next(err, result)\n  fs.readFile(file, next);\n}, (err, results) => {\n  // err est la première erreur renvoyée (le callback est appelée dès la 1ère erreur)\n  // results est le tableau (ordonné) des résultats intermédiaires\n});")])]),n("br"),e._v("\n            Il existe également les variantes :\n            "),n("ul",[n("li",[n("code",[e._v("mapSeries")]),e._v(" qui permet d'effectuer les traitements en séries ;")]),e._v(" "),n("li",[n("code",[e._v("mapLimit")]),e._v(" qui permet de limiter le nombre d'éléments traités en parallèle.")])])]),e._v(" "),n("p",[e._v("\n            La méthode "),n("code",[e._v("parallel")]),e._v(" permet d'effectuer en parallèle plusieurs opérations asynchrones distinctes :\n            "),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{attrs:{language:"js"}},[e._v("async.parallel([\n  (done) => {\n    // la signature de done est done(err, result)\n    fs.readFile('in.txt', done);\n  }, (done) => {\n    fs.writeFile('out.txt', 'finished !', done);\n  }\n], (err, results) => {\n  // err est la première erreur renvoyée (le callback est appelée dès la 1ère erreur)\n  // results est le tableau (ordonné) des resultats intermédiaires\n});")])]),n("br"),e._v("\n            Il existe également les variantes :\n            "),n("ul",[n("li",[n("code",[e._v("series")]),e._v(" qui permet d'effectuer les traitements en séries ;")]),e._v(" "),n("li",[n("code",[e._v("parallelLimit")]),e._v(" qui permet de limiter le nombre d'éléments traités en parallèle.")])])]),e._v(" "),n("p",[e._v("\n            La méthode "),n("code",[e._v("waterfall")]),e._v(" permet d'effectuer une sucession d'opérations asynchrones,\n            où chaque opération asynchrone utilise en entrée le résultat de l'opération asynchrone précédente :\n            "),n("pre",{directives:[{name:"highlightjs",rawName:"v-highlightjs"}]},[n("code",{attrs:{language:"js"}},[e._v("async.waterfall([\n    (next) => {\n        next(null, 'un', 'deux');\n    },\n    (arg1, arg2, next) => {\n        // arg1 vaut 'un' et arg2 vaut 'deux'\n        next(null, 'trois');\n    },\n    (arg1, next) => {\n        // arg1 vaut maintenant 'trois'\n        next(null, 'done');\n    }\n], function (err, result) => {\n    // result vaut 'done'\n});")])])])],1),e._v(" "),n("v-card-text",[n("v-card-title",{staticClass:"subheading secondary--text"},[e._v("TP Fil rouge")]),e._v(" "),n("p",[n("ol",[n("li",[e._v("\n                Dans le module "),n("code",[e._v("app/fs-utils.js")]),e._v(", créer la fonction "),n("code",[e._v("getDirStat()")]),e._v(" qui accepte 2 paramètres : le chemin absolu du dossier et une fonction callback.\n                "),n("code",[e._v("getDirStat()")]),e._v(" invoque le callback avec 2 paramètres :\n                "),n("ul",[n("li",[e._v("une erreur ;")]),e._v(" "),n("li",[e._v("\n                    un tableau d'objets contenant pour chaque fichier :\n                    "),n("ul",[n("li",[n("code",[e._v("name")]),e._v(" : son nom ;")]),e._v(" "),n("li",[n("code",[e._v("path")]),e._v(" : son chemin absolu ;")]),e._v(" "),n("li",[n("code",[e._v("isDirectory")]),e._v(" : un booléen indiquant s'il s'agit d'un dossier ;")]),e._v(" "),n("li",[n("code",[e._v("size")]),e._v(" : sa taille.")])])])])]),e._v(" "),n("li",[e._v("\n                Tester la fonction en l'invoquant avec les cas suivants :\n                "),n("ul",[n("li",[e._v("le chemin désigne un dossier qui existe ;")]),e._v(" "),n("li",[e._v("le chemin désigne un fichier ;")]),e._v(" "),n("li",[e._v("le chemin designe un dossier qui n'existe pas ;")])])]),e._v(" "),n("li",[e._v("En bonus : tester le cas où un des appels à "),n("code",[e._v("fs.stat")]),e._v(" retourne une erreur (utiliser "),n("a",{attrs:{href:"https://sinonjs.org/"}},[e._v("Sinon.JS")]),e._v(" pour faire un mock de la fonction).")])])])],1)],1)],1)],1)},l=[];n.d(t,"a",function(){return r}),n.d(t,"b",function(){return l})},419:function(e,t,n){"use strict";n.r(t);var r=n(415),l=n(390);for(var o in l)"default"!==o&&function(e){n.d(t,e,function(){return l[e]})}(o);var c=n(23),d=n(84),h=n.n(d),v=n(375),m=n(384),f=n(374),_=n(381),y=n(382),component=Object(c.a)(l.default,r.a,r.b,!1,null,null,null);t.default=component.exports,h()(component,{VCard:v.a,VCardText:m.a,VCardTitle:f.a,VFlex:_.a,VLayout:y.a})}}]);