(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{373:function(e,t,r){"use strict";var n=r(1),o=r(0);t.a=o.a.extend({name:"measurable",props:{height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},computed:{measurableStyles:function(){var e={},t=Object(n.a)(this.height),r=Object(n.a)(this.minHeight),o=Object(n.a)(this.minWidth),c=Object(n.a)(this.maxHeight),l=Object(n.a)(this.maxWidth),d=Object(n.a)(this.width);return t&&(e.height=t),r&&(e.minHeight=r),o&&(e.minWidth=o),c&&(e.maxHeight=c),l&&(e.maxWidth=l),d&&(e.width=d),e}}})},374:function(e,t,r){"use strict";var n=r(0);t.a=n.a.extend({name:"v-card-title",functional:!0,props:{primaryTitle:Boolean},render:function(e,t){var data=t.data,r=t.props,n=t.children;return data.staticClass=("v-card__title "+(data.staticClass||"")).trim(),r.primaryTitle&&(data.staticClass+=" v-card__title--primary"),e("div",data,n)}})},375:function(e,t,r){"use strict";r(376),r(377);var n=r(9);var o=r(0).a.extend({name:"elevatable",props:{elevation:[Number,String]},computed:{computedElevation:function(){return this.elevation},elevationClasses:function(){return this.computedElevation?(e={},t="elevation-"+this.computedElevation,r=!0,t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e):{};var e,t,r}}}),c=r(373),l=r(7),d=r(3),h=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e},m=Object(d.a)(n.a,o,c.a,l.a).extend({name:"v-sheet",props:{tag:{type:String,default:"div"},tile:Boolean},computed:{classes:function(){return h({"v-sheet":!0,"v-sheet--tile":this.tile},this.themeClasses,this.elevationClasses)},styles:function(){return this.measurableStyles}},render:function(e){var data={class:this.classes,style:this.styles,on:this.$listeners};return e(this.tag,this.setBackgroundColor(this.color,data),this.$slots.default)}}),v=r(41),f=Object.assign||function(e){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var t in source)Object.prototype.hasOwnProperty.call(source,t)&&(e[t]=source[t])}return e};t.a=Object(d.a)(v.a,m).extend({name:"v-card",props:{flat:Boolean,hover:Boolean,img:String,raised:Boolean},computed:{classes:function(){return f({"v-card":!0,"v-card--flat":this.flat,"v-card--hover":this.hover},m.options.computed.classes.call(this))},styles:function(){var style=f({},m.options.computed.styles.call(this));return this.img&&(style.background='url("'+this.img+'") center center / cover no-repeat'),style}},render:function(e){var t=this.generateRouteLink(this.classes),r=t.tag,data=t.data;return data.style=this.styles,e(r,this.setBackgroundColor(this.color,data),this.$slots.default)}})},376:function(e,t,r){},377:function(e,t,r){},378:function(e,t,r){},379:function(e,t,r){},381:function(e,t,r){"use strict";r(117);var n=r(83);t.a=Object(n.a)("flex")},382:function(e,t,r){"use strict";r(117);var n=r(83);t.a=Object(n.a)("layout")},384:function(e,t,r){"use strict";var n=r(1),o=r(375),c=(r(378),r(379),r(373)),l=r(3),d=Object(l.a)(c.a).extend({name:"v-responsive",props:{aspectRatio:[String,Number]},computed:{computedAspectRatio:function(){return Number(this.aspectRatio)},aspectStyle:function(){return this.computedAspectRatio?{paddingBottom:1/this.computedAspectRatio*100+"%"}:void 0},__cachedSizer:function(){return this.aspectStyle?this.$createElement("div",{style:this.aspectStyle,staticClass:"v-responsive__sizer"}):[]}},methods:{genContent:function(){return this.$createElement("div",{staticClass:"v-responsive__content"},this.$slots.default)}},render:function(e){return e("div",{staticClass:"v-responsive",style:this.measurableStyles,on:this.$listeners},[this.__cachedSizer,this.genContent()])}}),h=r(6),m=d.extend({name:"v-img",props:{alt:String,contain:Boolean,src:{type:[String,Object],default:""},gradient:String,lazySrc:String,srcset:String,sizes:String,position:{type:String,default:"center center"},transition:{type:[Boolean,String],default:"fade-transition"}},data:function(){return{currentSrc:"",image:null,isLoading:!0,calculatedAspectRatio:void 0}},computed:{computedAspectRatio:function(){return this.normalisedSrc.aspect},normalisedSrc:function(){return"string"==typeof this.src?{src:this.src,srcset:this.srcset,lazySrc:this.lazySrc,aspect:Number(this.aspectRatio||this.calculatedAspectRatio)}:{src:this.src.src,srcset:this.srcset||this.src.srcset,lazySrc:this.lazySrc||this.src.lazySrc,aspect:Number(this.aspectRatio||this.src.aspect||this.calculatedAspectRatio)}},__cachedImage:function(){if(!this.normalisedSrc.src&&!this.normalisedSrc.lazySrc)return[];var e=[],t=this.isLoading?this.normalisedSrc.lazySrc:this.currentSrc;this.gradient&&e.push("linear-gradient("+this.gradient+")"),t&&e.push('url("'+t+'")');var image=this.$createElement("div",{staticClass:"v-image__image",class:{"v-image__image--preload":this.isLoading,"v-image__image--contain":this.contain,"v-image__image--cover":!this.contain},style:{backgroundImage:e.join(", "),backgroundPosition:this.position},key:+this.isLoading});return this.transition?this.$createElement("transition",{attrs:{name:this.transition,mode:"in-out"}},[image]):image}},watch:{src:function(){this.isLoading?this.loadImage():this.init()},"$vuetify.breakpoint.width":"getSrc"},mounted:function(){this.init()},methods:{init:function(){if(this.normalisedSrc.lazySrc){var e=new Image;e.src=this.normalisedSrc.lazySrc,this.pollForSize(e,null)}this.normalisedSrc.src&&this.loadImage()},onLoad:function(){this.getSrc(),this.isLoading=!1,this.$emit("load",this.src)},onError:function(){Object(h.a)("Image load failed\n\nsrc: "+this.normalisedSrc.src,this),this.$emit("error",this.src)},getSrc:function(){this.image&&(this.currentSrc=this.image.currentSrc||this.image.src)},loadImage:function(){var e=this,image=new Image;this.image=image,image.onload=function(){image.decode?image.decode().catch(function(t){Object(h.b)("Failed to decode image, trying to render anyway\n\nsrc: "+e.normalisedSrc.src+(t.message?"\nOriginal error: "+t.message:""),e)}).then(e.onLoad):e.onLoad()},image.onerror=this.onError,image.src=this.normalisedSrc.src,this.sizes&&(image.sizes=this.sizes),this.normalisedSrc.srcset&&(image.srcset=this.normalisedSrc.srcset),this.aspectRatio||this.pollForSize(image),this.getSrc()},pollForSize:function(img){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;!function r(){var n=img.naturalHeight,o=img.naturalWidth;n||o?e.calculatedAspectRatio=o/n:null!=t&&setTimeout(r,t)}()},__genPlaceholder:function(){if(this.$slots.placeholder){var e=this.isLoading?[this.$createElement("div",{staticClass:"v-image__placeholder"},this.$slots.placeholder)]:[];return this.transition?this.$createElement("transition",{attrs:{name:this.transition}},e):e[0]}}},render:function(e){var t=d.options.render.call(this,e);return t.data.staticClass+=" v-image",t.data.attrs={role:this.alt?"img":void 0,"aria-label":this.alt},t.children=[this.__cachedSizer,this.__cachedImage,this.__genPlaceholder(),this.genContent()],e(t.tag,t.data,t.children)}}).extend({name:"v-card-media",mounted:function(){Object(h.c)("v-card-media",this.src?"v-img":"v-responsive",this)}}),v=r(374);r.d(t,"a",function(){return _});var f=Object(n.c)("v-card__actions"),_=Object(n.c)("v-card__text");o.a,v.a},397:function(e,t,r){"use strict";r.r(t);var n=r(398),o=r.n(n);for(var c in n)"default"!==c&&function(e){r.d(t,e,function(){return n[e]})}(c);t.default=o.a},398:function(e,t){},413:function(e,t,r){"use strict";var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-layout",{attrs:{column:"","justify-center":"","align-center":""}},[r("v-flex",{attrs:{xs12:"",sm8:"",md6:""}},[r("v-card",[r("v-card-title",{staticClass:"headline primary--text"},[e._v("Node.js en production")]),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"subheading primary--text"},[e._v("La variable d'environnement NODE_ENV")]),e._v(" "),r("p",[e._v("\n          En production, il est important de définir la variable d'environnement "),r("code",[e._v("NODE_ENV=production")]),e._v(".\n          En effet, certaines librairies modifient leur comportement lorsque "),r("code",[e._v("NODE_ENV=production")]),e._v(".\n        ")]),e._v(" "),r("p",[e._v("\n          Par exemple, Express va notamment :\n          "),r("ul",[r("li",[e._v("mettre en cache les templates ;")]),e._v(" "),r("li",[e._v("renvoyer des messages d'erreur moins verbeux.")])])]),e._v(" "),r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Les fichiers statiques")]),e._v(" "),r("p",[e._v("\n          Node.js est capable de servir des fichiers statiques, mais n'est pas aussi performant qu'un serveur HTTP conçu pour ce besoin.\n          Il est donc recommandé d'utiliser un serveur HTTP comme nginx ou Apache ou d'utiliser un reverse-proxy mettant en cache les fichiers statiques.\n        ")]),e._v(" "),r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Cluster")]),e._v(" "),r("p",[e._v("\n          Aujourd'hui, la majorité des processeurs ont plusieurs coeurs, mais Javascript étant monothreadé, seulement un coeur sera réellement utilisé.\n          Pour répondre à ce besoin, Node.js fournit le module "),r("a",{attrs:{href:"https://nodejs.org/docs/latest/api/cluster.html"}},[e._v("cluster")]),e._v(", qui permet d'exécuter du code Javascript dans un nouveau processus.\n          A noter :\n          "),r("ul",[r("li",[e._v("il s'agit de processus distincts, c'est-à-dire qu'ils n'utilisent pas la même mémoire ;")]),e._v(" "),r("li",[e._v("depuis peu, Node.js permet de faire des "),r("a",{attrs:{href:"https://nodejs.org/docs/latest/api/worker_threads.html"}},[e._v("worker_threads")]),e._v(" (c'est expérimental actuellement) ;")]),e._v(" "),r("li",[e._v("Node.js est capable de répartir les requêtes entrantes entre les différentes processus fils d'un même processus parent.")])])]),e._v(" "),r("p",[e._v("\n          Pour un serveur HTTP, il y aura souvent :\n          "),r("ul",[r("li",[e._v("un processus parent, qui se chargera de créer et tuer les processus enfants ;")]),e._v(" "),r("li",[e._v("n processus enfants, qui traiteront les requêtes entrantes (n étant le nombre de CPUs, récupéré grâce à "),r("a",{attrs:{href:"https://nodejs.org/docs/latest/api/os.html#os_os_cpus"}},[e._v("os.cpus()")]),e._v(")")])])]),e._v(" "),r("v-card-title",{staticClass:"subheading primary--text"},[e._v("Process manager")]),e._v(" "),r("p",[e._v("\n          Gérer nous même les processus Node.js est compliqué, notamment parce qu'il faut gérer les cas d'erreur (que se passe t'il si le processus plante pour une erreur inattendue ?).\n          C'est pour cela qu'il est recommandé d'utiliser un outil pour gérer les processus :\n          "),r("ul",[r("li",[e._v("soit en utilisant un outil d'orchestration, comme "),r("a",{attrs:{href:"https://kubernetes.io/"}},[e._v("kubernetes")]),e._v(", qui gérera lui-même le load-balancing de containeurs Docker et se chargera de redémarrer un processus s'il y en a un qui meurt ;")]),e._v(" "),r("li",[e._v("soit en utilisant une librairie, comme "),r("a",{attrs:{href:"https://www.npmjs.com/package/pm2"}},[e._v("pm2")]),e._v(", qui va utiliser le module cluster pour gérer les processus Node.JS et le load-balancing.")])])])],1),e._v(" "),r("v-card-text",[r("v-card-title",{staticClass:"subheading secondary--text"},[e._v("TP Fil rouge")]),e._v(" "),r("p",[e._v("\n          Nous allons mettre en place un process-manager pour notre serveur HTTP :\n          "),r("ol",[r("li",[e._v("rajouter un script "),r("code",[e._v("start-cluster")]),e._v(" dans le fichier "),r("code",[e._v("package.json")]),e._v(" qui lance plusieurs workers avec "),r("a",{attrs:{href:"https://www.npmjs.com/package/pm2"}},[e._v("pm2-runtime")]),e._v(" ;")]),e._v(" "),r("li",[e._v("lancer la commande "),r("code",[e._v("npm run start-cluster")]),e._v(", et vérifier qu'il y a bien plusieurs processus Node.js qui sont lancés ;")]),e._v(" "),r("li",[e._v("killer un des processus enfants : que se passe-t-il ?")])])])],1)],1)],1)],1)},o=[];r.d(t,"a",function(){return n}),r.d(t,"b",function(){return o})},422:function(e,t,r){"use strict";r.r(t);var n=r(413),o=r(397);for(var c in o)"default"!==c&&function(e){r.d(t,e,function(){return o[e]})}(c);var l=r(23),d=r(84),h=r.n(d),m=r(375),v=r(384),f=r(374),_=r(381),S=r(382),component=Object(l.a)(o.default,n.a,n.b,!1,null,null,null);t.default=component.exports,h()(component,{VCard:m.a,VCardText:v.a,VCardTitle:f.a,VFlex:_.a,VLayout:S.a})}}]);